# gcc -march=native -E -v - </dev/null 2>&1 | grep cc1
# For AMD Ryzen Threadripper PRO 7955WX 16-Cores
#ARCH_SPECIFIC_OPTS=" -march=znver4 -mmmx -mpopcnt -msse -msse2 -msse3 -mssse3 -msse4.1 -msse4.2 -mavx -mavx2 -msse4a -mno-fma4 -mno-xop -mfma -mavx512f -mbmi -mbmi2 -maes -mpclmul -mavx512vl -mavx512bw -mavx512dq -mavx512cd -mavx512vbmi -mavx512ifma -mavx512vpopcntdq -mavx512vbmi2 -mgfni -mvpclmulqdq -mavx512vnni -mavx512bitalg -mavx512bf16 -mno-avx512vp2intersect -mno-3dnow -madx -mabm -mno-cldemote -mclflushopt -mclwb -mclzero -mcx16 -mno-enqcmd -mf16c -mfsgsbase -mfxsr -mno-hle -msahf -mno-lwp -mlzcnt -mmovbe -mno-movdir64b -mno-movdiri -mmwaitx -mno-pconfig -mpku -mprfchw -mno-ptwrite -mrdpid -mrdrnd -mrdseed -mno-rtm -mno-serialize -mno-sgx -msha -mshstk -mno-tbm -mno-tsxldtrk -mvaes -mno-waitpkg -mwbnoinvd -mxsave -mxsavec -mxsaveopt -mxsaves -mno-amx-tile -mno-amx-int8 -mno-amx-bf16 -mno-uintr -mno-hreset -mno-kl -mno-widekl -mno-avxvnni -mno-avx512fp16 -mno-avxifma -mno-avxvnniint8 -mno-avxneconvert -mno-cmpccxadd -mno-amx-fp16 -mno-prefetchi -mno-raoint -mno-amx-complex -mno-avxvnniint16 -mno-sm3 -mno-sha512 -mno-sm4 -mno-apxf -mno-usermsr --param l1-cache-size=32 --param l1-cache-line-size=64 --param l2-cache-size=1024 -mtune=znver4 -fcf-protection -foffload-options=-fcf-protection=none "
# disable avx512 for valgrind

# AMD Ryzen 7 7735HS
# CPU_FLAGS_X86: aes avx avx2 bmi1 bmi2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2 sse3 sse4_1 sse4_2 #
# sse4a ssse3 vpclmulqdq
# Ryzen 3600:
# CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2 sse3 sse4_1 sse4_2 sse4a ssse3"
# AMD Ryzen Threadripper PRO 7955WX 16-Cores
#CPU_FLAGS_X86: aes avx avx2 avx512_bf16 avx512_bitalg avx512_vbmi2 avx512_vnni avx512_vpopcntdq avx512bw avx512cd
# avx512dq avx512f avx512ifma avx512vbmi avx512vl bmi1 bmi2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2
# sse3 sse4_1 sse4_2 sse4a ssse3 vpclmulqdq
# Use znver3 as lowest common denominator (both support znver4, but znver3 is safer)
# Or keep x86-64-v3 for broader compatibility
# Flags supported by BOTH Threadripper 7955WX and Ryzen 7735HS
ARCH_SPECIFIC_OPTS=" -march=x86-64-v3 -mtune=znver3 "
COMMON_FLAGS=" ${ARCH_SPECIFIC_OPTS} -fomit-frame-pointer -O2 -pipe -floop-block -fgraphite-identity -floop-parallelize-all "
CPU_FLAGS_X86="aes avx avx2 bmi1 bmi2 f16c fma3 mmx mmxext pclmul popcnt rdrand sha sse sse2 sse3 sse4_1 sse4_2 sse4a ssse3 vpclmulqdq"

CFLAGS="${COMMON_FLAGS}"
GCC_CHECKS_LIST="release"
CXXFLAGS="${COMMON_FLAGS}"
FCFLAGS="${COMMON_FLAGS}"
FFLAGS="${COMMON_FLAGS}"
LC_MESSAGES=C.utf8
MAKEOPTS="-j20"
EMERGE_DEFAULT_OPTS="--jobs 4 --load-average 28"
USE="X vaapi -doc -cups -opencl -jemalloc"
VIDEO_CARDS="nvidia radeonsi amdgpu"
#VIDEO_CARDS="radeonsi amdgpu"
#FEATURES="buildpkg"
PKGDIR="/var/cache/binpkgs"
BINPKG_FORMAT="gpkg"
BINPKG_COMPRESS="zstd"
BINPKG_COMPRESS_FLAG_ZSTD="-T0"
L10N="en-GB"
#LLVM_TARGETS="X86 NVPTX AMDGPU"
LLVM_TARGETS="X86 AMDGPU"
IGNORE_PREEMPT_RT_PRESENCE="1"
INPUT_DEVICES="libinput"
GENTOO_MIRRORS="https://mirror.init7.net/gentoo/ \
    rsync://mirror.init7.net/gentoo/ \
    http://mirrors.ircam.fr/pub/gentoo-distfiles/ \
    http://ftp.fau.de/gentoo \
    rsync://ftp.fau.de/gentoo \
    http://ftp-stud.hs-esslingen.de/pub/Mirrors/gentoo/ \
    rsync://ftp-stud.hs-esslingen.de/gentoo/ \
    http://ftp.uni-stuttgart.de/gentoo-distfiles/"
http_proxy="http://10.60.120.81:3142" # apt-cacher-ng