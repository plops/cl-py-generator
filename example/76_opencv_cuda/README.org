|       |                                                                                       |
| gen01 | try example code for camera calibration with the images that come with opencv release |
| gen02 | display checkerboard with charuco indices, fullscreen, shift in x and y               |
| gen03 | load dng files and detect markers                                                     |
| gen04 | load png files and detect markers                                                     |
- install dependencies for cl-py-generator on popos
#+begin_example
sudo apt install jq
pip install --user black nbdev

#+end_example

- install opencv on popos
- https://gist.github.com/raulqf/f42c718a658cddc16f9df07ecc627be7
#+begin_example
sudo apt install system76-cudnn-11.2
sudo apt install libavcodec-dev libavformat-dev libswscale-dev libgstreamer1.0-dev libgstreamer-plugins-base1.0-dev libxvidcore-dev x264 libx264-dev libfaac-dev libmp3lame-dev libtheora-dev libfaac-dev libmp3lame-dev libvorbis-dev libopencore-amrnb-dev libopencore-amrwb-dev libxine2-dev libv4l-dev v4l-utils  libgtk-3-dev python3-dev python3-pip
https://codeload.github.com/opencv/opencv_contrib/tar.gz/refs/tags/4.5.5
https://codeload.github.com/opencv/opencv/tar.gz/refs/tags/4.5.5


sudo pip install virtualenv virtualenvwrapper
sudo rm -rf ~/.cache/pip
export WORKON_HOME=$HOME/.virtualenvs
export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3
source /usr/local/bin/virtualenvwrapper.sh
mkvirtualenv cv -p python3
pip install numpy


mkdir b; cd b

cmake -D CMAKE_BUILD_TYPE=RELEASE \
-D CMAKE_INSTALL_PREFIX=/usr/local \
-D WITH_TBB=ON \
-D ENABLE_FAST_MATH=1 \
-D CUDA_FAST_MATH=1 \
-D WITH_CUBLAS=1 \
-D WITH_CUDA=ON \
-D BUILD_opencv_cudacodec=OFF \
-D WITH_CUDNN=ON \
-D OPENCV_DNN_CUDA=ON \
-D CUDA_ARCH_BIN=7.5 \
-D WITH_V4L=ON \
-D WITH_QT=OFF \
-D WITH_OPENGL=ON \
-D WITH_GSTREAMER=ON \
-D OPENCV_GENERATE_PKGCONFIG=ON \
-D OPENCV_PC_FILE_NAME=opencv.pc \
-D OPENCV_ENABLE_NONFREE=ON \
-D OPENCV_PYTHON3_INSTALL_PATH=~/.virtualenvs/cv/lib/python3.9/site-packages \
-D PYTHON_EXECUTABLE=~/.virtualenvs/cv/bin/python \
-D OPENCV_EXTRA_MODULES_PATH=~/src/opencv_contrib-4.5.5/modules \
-D INSTALL_PYTHON_EXAMPLES=OFF \
-D INSTALL_C_EXAMPLES=OFF \
-D BUILD_EXAMPLES=OFF \
-G Ninja ..

--   NVIDIA CUDA:                   YES (ver 11.2, CUFFT CUBLAS FAST_MATH)
--     NVIDIA GPU arch:             75
--     NVIDIA PTX archs:
-- 
--   cuDNN:                         YES (ver 8.1.1)

time ninja
sudo ninja install

real	15m22.306s
user	130m47.101s
sys	5m15.336s



sudo /bin/bash -c 'echo "/usr/local/lib" >> /etc/ld.so.conf.d/opencv.conf'
sudo ldconfig


sudo cp -r ~/.virtualenvs/cv/lib/python3.9/site-packages/cv2 /usr/local/lib/python3.9/dist-packages
sudo nano /usr/local/lib/python3.9/dist-packages/cv2/config-3.9.py 

#+end_example


- how to run it:
#+begin_example
export WORKON_HOME=$HOME/.virtualenvs
export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3
source /usr/local/bin/virtualenvwrapper.sh
mkvirtualenv cv -p python3

#+end_example


- install some more python requirements into the virtual env
#+begin_example
pip install pandas jupyter
https://docs.opencv.org/4.x/dc/dbb/tutorial_py_calibration.html
sudo apt install sbcl
#+end_example

- references
  #+begin_example
(*) .. particularly interesting

https://longervision.github.io/2017/03/12/ComputerVision/OpenCV/opencv-external-posture-estimation-ArUco-board/
https://longervision.github.io/2017/03/13/ComputerVision/OpenCV/opencv-external-posture-estimation-ChArUco-board/
https://github.com/kyle-bersani/opencv-examples/tree/master/CalibrationByCharucoBoard
https://docs.opencv.org/4.5.5/ python below c++ definitions

aruco paper (2014)
 - 10.1016/j.patcog.2014.01.005
 - markers selected by random process
 - considering:
   - number of transitions
   - hamming distance to other markers
   - correctly identify marker rotation (marker self-distance)
   - the final dictionary has a value tau that is the minimum hamming distance between any two markers
 - detection algorithm:
   - local threshold (fast alternative to canny)
   - contour extraction (suzuki abe 10.1016/0734-189X(85)90016-7)
     - defines hierarchical relationships among borders
     - differentiates outer boundary and hole boundary
     - nice video demonstration
       - https://www.youtube.com/watch?v=_aTC-Rc4Io0
         - detect blue marker
  - polygonal approximation (douglas peucker)
       - only keep 4-vertex polygons
       - https://www.youtube.com/watch?v=IG3UkAqHnQI
         - approximate contours with polygon
  - undo perspective projection by computing homography matrix
  - extract internal code square
  - optimal threshold for bimodal image (otsu)
  - divide into grid, sample bits
  - marker identification and error correction
    - 4 identifiers (one for each possible rotation)
    - lookup in dictionary using sorted balanced binary tree
    - errors of at most (tau-1)/2 bits can be corrected
    - complexity of error correction is O(4 * len(dictionary))
    - reported as aruco_dict.maxCorrectionBits

https://www.frontiersin.org/articles/10.3389/fbinf.2021.740342/full differential renderer to predict pose and protein structure (on localization microscopy images)
  - SMLM reconstruction is a z-projection of the structure being imaged (with unknown rotation and translation)
    - ? is the size of the fluorescent marker a limitation, what if can't go into the structure
  - differentiable renderer for SMLM point clouds (parameters: x,y, 3 angles, sigma)
  - images that are close in appearance usually close in pose
  - CEP152/HsSAS-6 complex
    - ? cryo-em or x-ray structure as ground truth?
  - https://github.com/OniDaito/Holly
    - nice animations, makes it a bit clearer
  
https://www.edwardrosten.com/work/woodford_2020_large.pdf
  - ceres solver .. for large scale bundle adjustment
    - (*) http://ceres-solver.org/automatic_derivatives.html C++ Jet type (auto-differentiation)
    - A simple (well behaved) differentiable interpolation is the Cubic Hermite Spline.
    - very good documentation
    - (*) hessian, handling of manifolds (LocalParameterization, rank deficient Jacobian)
  - 2016 drap inverse radial lens distortions
  - https://www2.imm.dtu.dk/pubdb/edoc/imm3215.pdf non-linear least squares lectures
  - colmap for initial camera parameters https://colmap.github.io/tutorial.html
  - image pyramid to improve convergence



https://jax-cosmo.readthedocs.io/en/latest/notebooks/jax-cosmo-intro.html
  - library for cosmology
  - has cubic interpolation with jax
     - discussion: https://github.com/DifferentiableUniverseInitiative/jax_cosmo/issues/29
     - (*) standalone interoplator https://github.com/DifferentiableUniverseInitiative/jax_cosmo/blob/master/jax_cosmo/scipy/interpolate.py
  - discussion Fisher/covariance https://jax-cosmo.readthedocs.io/en/latest/notebooks/jax-cosmo-intro.html
  
https://github.com/CosmoStat/mccd
  - non-parametric MCCD PSF modelling
  - generate a PSF model based on stars observations in the field of view
  -  Once trained, the MCCD PSF model can then recover the PSF at any position in the field of view.
  - allows to output interpolated PSFs with a specific centroid.
  -    RBF interpolation for the global part.
#+end_example
